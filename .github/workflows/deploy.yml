name: Deploy to Hostinger

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: SSH deploy
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: 153.92.9.238
          port: 65002
          username: u673267555
          key: ${{ secrets.HOSTINGER_SSH_KEY }}
          script: |
            cd /home/u673267555/domains/invairo.com.au/nodejs
            if ! git rev-parse --git-dir > /dev/null 2>&1; then
              git init
              git remote add origin https://github.com/olegdribling/time_tracker.git
            fi
            git fetch origin main
            git reset --hard origin/main
            rm -rf dist
            git checkout HEAD -- dist
            cp /home/u673267555/domains/invairo.com.au/public_html/.builds/config/.env .env.hostinger
            grep -v '^PORT=' .env.hostinger | grep -v '^VITE_API_URL=' > .env
            rm .env.hostinger
            mkdir -p tmp && touch tmp/restart.txt
